on:
  workflow_dispatch:
    inputs:
      id:
        description: Bubbli ID (path of share URL)
        required: true

jobs:
  convert:
    name: Convert cubemap to equirectangular
    runs-on: ubuntu-22.04
    steps:
    - name: Help
      run: wget --help
    - name: Setup Blender
      uses: Moguri/setup-blender@v1
      with:
        blender-version: "5.0.0"
    - name: Setup Python
      uses: actions/setup-python@v6.0.0
      with:
        python-version: "^3.8.0"
    - name: Install cube2sphere
      run: pip install cube2sphere
    - name: Download files
      run: |
        wget
        -o front.jpg https://d39cwcjmzdw2iw.cloudfront.net/${{ inputs.id }}/stitched_pz.jpg
        -o back.jpg https://d39cwcjmzdw2iw.cloudfront.net/${{ inputs.id }}/stitched_nz.jpg
        -o left.jpg https://d39cwcjmzdw2iw.cloudfront.net/${{ inputs.id }}/stitched_nx.jpg
        -o right.jpg https://d39cwcjmzdw2iw.cloudfront.net/${{ inputs.id }}/stitched_px.jpg
        -o top.jpg https://d39cwcjmzdw2iw.cloudfront.net/${{ inputs.id }}/stitched_py.jpg
        -o bottom.jpg https://d39cwcjmzdw2iw.cloudfront.net/${{ inputs.id }}/stitched_ny.jpg
    - name: Convert with cube2sphere
      run: cube2sphere front.jpg back.jpg right.jpg left.jpg top.jpg bottom.jpg -ocubemap -fJPG
